# ============================================================================
# ScribeSnap Environment Configuration
# Copy this file to .env and fill in your values.
# ============================================================================

# --- Database ---
# What: PostgreSQL connection string for async SQLAlchemy (asyncpg driver)
# Format: postgresql+asyncpg://user:password@host:port/dbname
# Default: Works with the Docker Compose postgres service out of the box
DATABASE_URL=postgresql+asyncpg://scribesnap:scribesnap_secret@postgres:5432/scribesnap

# What: PostgreSQL credentials for the Docker Compose postgres service
# How to obtain: Choose secure values for production; defaults are fine for dev
POSTGRES_USER=scribesnap
POSTGRES_PASSWORD=scribesnap_secret
POSTGRES_DB=scribesnap

# --- Google Gemini ---
# What: API key for Google Gemini Vision API (used for handwriting recognition)
# How to obtain: https://aistudio.google.com/app/apikey (free tier available)
# Required: YES — the application cannot parse notes without this
GEMINI_API_KEY=your_gemini_api_key_here

# What: Which Gemini model to use for vision tasks
# Valid values: gemini-1.5-flash (faster, cheaper), gemini-1.5-pro (higher quality)
# Trade-off: flash is ~10x cheaper but slightly less accurate on messy handwriting
GEMINI_MODEL=gemini-1.5-flash

# --- File Storage ---
# What: Root directory for uploaded images (relative to backend working dir)
# Default: ./storage — Docker volume mounts this for persistence
STORAGE_ROOT=./storage

# What: Maximum upload file size in bytes
# Default: 10485760 = 10MB — prevents memory exhaustion on large uploads
# Valid range: 1048576 (1MB) to 52428800 (50MB)
MAX_FILE_SIZE=10485760

# --- CORS ---
# What: Allowed origins for cross-origin requests (comma-separated)
# Why: Restricts API access to only our frontend — prevents unauthorized access
# Development: http://localhost:3000 for Next.js dev server
CORS_ORIGINS=http://localhost:3000

# --- Server ---
# What: Backend server host and port
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000

# What: Log level for structured JSON logging
# Valid values: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Trade-off: DEBUG gives maximum visibility but generates high log volume
LOG_LEVEL=INFO

# --- Connection Pool ---
# What: SQLAlchemy async connection pool settings
# POOL_SIZE: Number of persistent connections (how many concurrent DB ops)
# MAX_OVERFLOW: Extra temporary connections during traffic spikes
# POOL_PRE_PING: Validates connections before use (catches stale connections)
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_PRE_PING=true

# --- Retry Configuration ---
# What: Tenacity retry settings for Gemini API calls
# RETRY_MAX_ATTEMPTS: How many times to retry before giving up
# RETRY_MIN_WAIT: Minimum seconds between retries (exponential backoff base)
# RETRY_MAX_WAIT: Maximum seconds between retries (caps exponential growth)
RETRY_MAX_ATTEMPTS=3
RETRY_MIN_WAIT=2
RETRY_MAX_WAIT=10

# --- Circuit Breaker ---
# What: Protects against cascade failures when Gemini is down
# FAILURE_THRESHOLD: Consecutive failures before opening circuit
# RECOVERY_TIMEOUT: Seconds to wait before testing if Gemini recovered
CB_FAILURE_THRESHOLD=5
CB_RECOVERY_TIMEOUT=60

# --- Rate Limiting ---
# What: Per-IP request rate limit (sliding window)
# Why: Prevents abuse and DoS attacks
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=3600

# --- Frontend ---
# What: Backend API URL for the Next.js frontend to call
NEXT_PUBLIC_API_URL=http://localhost:8000
